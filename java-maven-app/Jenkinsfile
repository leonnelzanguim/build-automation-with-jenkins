#!/user/bin/env groovy

library identifier: 'jenkins-shared-library@main', retriever: modernSCM(
  [
    $class: 'GitSCMSource',
    remote: 'https://github.com/leonnelzanguim/jenkins-shared-library.git',
    credentialsId: 'github-credentials'
  ]
)

def gv

pipeline {
  agent any
  tools{
    maven "maven-3.9"
  }
  stages {
    stage("init") {
      steps {
        script {
          gv = load "java-maven-app/script.groovy"
        }
      }
    }
     stage("build Jar") {
      steps {
        script {
          buildJar()
        }
      }
    }
    stage("build and Push Image") {
      steps {
        script {
          buildImage '10012975/demo-java-maven-app:6.0'
          dockerLogin()
          dockerPush '10012975/demo-java-maven-app:6.0'
        }
      }
    }
    stage("deploy") {
      steps { 
        script {
          gv.deployApp()   
        }
      }
    }
  }
}
