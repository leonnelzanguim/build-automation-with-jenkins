#!/user/bin/env groovy

@Library('jenkins-shared-library')
def gv

pipeline {
  agent any
  tools{
    maven "maven-3.9"
  }
  stages {
    stage("init") {
      steps {
        script {
          gv = load "java-maven-app/script.groovy"
        }
      }
    }
     stage("build Jar") {
      steps {
        script {
          buildJar()
        }
      }
    }
    stage("build and Push Image") {
      steps {
        script {
          buildImage '10012975/demo-java-maven-app:5.0'
          dockerLogin()
          dockerPush '10012975/demo-java-maven-app:5.0'
        }
      }
    }
    stage("deploy") {
      steps { 
        script {
          gv.deployApp()   
        }
      }
    }
  }
}
